pico-8 cartridge // http://www.pico-8.com
version 30
__lua__
plt={15,15,8,8,9,9,8,8,15,15}
-- underwater pal
plt2={15,15,2,2,14,14,2,2,15,15}
pal(0,1,1)

function _draw()
	cls()
		
	-- bg
	rectfill(0,0,128,64-8, 2)
	-- water surface
	fillp(0b1010010110100101)
	rectfill(0,64-7,128,64,2+1*16)
	fillp()	
	
	for x=0,127 do
		-- snake path
		y = 78+(10+7*sin(time()/10))*sin(sin(time()/20)+time()+x/50)
	 
	 -- "archimedes" effect
	 y+=-2+15*sin(time()/3)
	 
		-- underwater plt swap
		if y > 66 then
			tmpplt = plt2
		else
			tmpplt = plt
		end
			
		circ(x-23,y,2,tmpplt[5])
		circfill(x-20,y,3,tmpplt[1+flr(-x/3%9)])
	end
	
	-- reflection
	st=64*64
	for l=1,8 do
		-- copy line data from memory in reverse order
		memcpy(0x6000 + st+l*64, 0x6000 + st-l*64, 0x40)
	end
	
	-- underwater area displacement 
	rectfill(0,70,128,76,0)
	for l=72,127 do
		if l%2 == 0 then
			-- displace even lines
			memcpy(0x6000 + l*64, 0x6000 + (l+3)*64, 0x40)
		end
	end
	
	print(stat(1))
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
